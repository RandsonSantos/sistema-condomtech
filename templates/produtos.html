{% extends 'base.html' %}
{% block title %}Produtos Cadastrados{% endblock %}

{% block content %}
<h2 class="mb-4">üì¶ Produtos Cadastrados</h2>

<!-- Filtro de busca -->
<form method="GET" action="{{ url_for('listar_produtos') }}" class="mb-4">
  <div class="row g-2">
    <div class="col-md-6">
      <input type="text" name="nome" class="form-control" placeholder="Buscar por nome..." value="{{ nome }}">
    </div>
    <div class="col-md-4">
      <select name="tipo" class="form-select">
        <option value="">Todos os Tipos</option>
        <option value="produto" {% if tipo == 'produto' %}selected{% endif %}>Produto</option>
        <option value="servico" {% if tipo == 'servico' %}selected{% endif %}>Servi√ßo</option>
      </select>
    </div>
    <div class="col-md-2 d-flex gap-2">
      <button type="submit" class="btn btn-outline-primary w-100">
        <i class="bi bi-search"></i> Filtrar
      </button>
      {% if nome or tipo %}
        <a href="{{ url_for('listar_produtos') }}" class="btn btn-outline-secondary w-100">
          <i class="bi bi-x-circle"></i> Limpar
        </a>
      {% endif %}
    </div>
  </div>
</form>

<!-- A√ß√µes -->
<div class="mb-4 d-flex justify-content-between">
  <a href="{{ url_for('cadastrar_produto') }}" class="btn btn-success">
    <i class="bi bi-plus-lg"></i> Cadastrar Novo Produto
  </a>
</div>

<!-- Feedback de filtros -->
{% if nome or tipo %}
  <p class="mt-2 text-muted">
    <i class="bi bi-filter"></i> Filtros aplicados:
    {% if nome %}<span class="badge bg-primary">{{ nome }}</span>{% endif %}
    {% if tipo %}<span class="badge bg-secondary">{{ tipo|capitalize }}</span>{% endif %}
  </p>
{% endif %}

<!-- Tabela de produtos -->
{% if produtos %}
  <div class="table-responsive">
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Nome</th>
          <th>Descri√ß√£o</th>
          <th class="text-nowrap">Pre√ßo</th>
          <th class="text-nowrap">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for produto in produtos %}
        <tr>
          <td>{{ produto.nome }}</td>
          <td>{{ produto.descricao }}</td>
          <td>R$ {{ '%.2f'|format(produto.preco) }}</td>
          <td class="d-flex gap-2">
            <a href="{{ url_for('editar_produto', produto_id=produto.id) }}" class="btn btn-sm btn-outline-warning">
              <i class="bi bi-pencil-square"></i> Editar
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagina√ß√£o -->
  {% if paginacao.pages > 1 %}
  <nav aria-label="Navega√ß√£o de p√°ginas">
    <ul class="pagination justify-content-center mt-4">
      {% if paginacao.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('listar_produtos', page=paginacao.prev_num, nome=nome, tipo=tipo) }}">
            &laquo; Anterior
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&laquo; Anterior</span></li>
      {% endif %}

      {% for num in paginacao.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if num %}
          {% if num == paginacao.page %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% else %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('listar_produtos', page=num, nome=nome, tipo=tipo) }}">{{ num }}</a>
            </li>
          {% endif %}
        {% else %}
          <li class="page-item disabled"><span class="page-link">‚Ä¶</span></li>
        {% endif %}
      {% endfor %}

      {% if paginacao.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('listar_produtos', page=paginacao.next_num, nome=nome, tipo=tipo) }}">
            Pr√≥xima &raquo;
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Pr√≥xima &raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
{% else %}
  <div class="alert alert-warning">Nenhum produto encontrado com os filtros informados.</div>
{% endif %}
{% endblock %}
